<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
    <title>{{ my_username }} Games Per Month</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1, h2 { text-align: center; }
        canvas { display: block; margin: 20px auto; max-width: 1000px; height: 500px !important; }
        table { border-collapse: collapse; margin: 20px auto; }
        th, td { border: 1px solid #444; padding: 6px 10px; text-align: center; min-width: 50px; }
        th { background: #f0f0f0; }
    </style>
</head>
<body>
    <h1>{{ my_username }} Games Played Per Month</h1>

    <!-- Line chart -->
    <canvas id="gamesChart"></canvas>

    <!-- Heatmap-style table -->
    <h2>Monthly Heatmap</h2>
    <table>
        <thead>
            <tr>
                <th>Year</th>
                <th>Jan</th><th>Feb</th><th>Mar</th><th>Apr</th>
                <th>May</th><th>Jun</th><th>Jul</th><th>Aug</th>
                <th>Sep</th><th>Oct</th><th>Nov</th><th>Dec</th>
            </tr>
        </thead>
        <tbody>
            {% for year, months_dict in results.items() %}
            <tr>
                <td>{{ year }}</td>
                {% for m in range(1, 13) %}
                    {% set count = months_dict[m] %}
                    {% set ratio = count / max_games %}
                    {% if ratio > 1 %}{% set ratio = 1 %}{% endif %}
                    {% set red = (255 * ratio)|round %}
                    {% set green = (200 * (1-ratio))|round %}
                    <td style="background-color: rgba({{ red }}, {{ green }}, 100, 0.6)">
                        {{ count }}
                    </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        const labels = {{ months|tojson }};
        const data = {{ counts|tojson }};

        new Chart(document.getElementById("gamesChart"), {
            type: "line",
            data: {
                labels: labels,
                datasets: [{
                    label: "Games Played",
                    data: data,
                    borderColor: "#2196f3",
                    backgroundColor: "rgba(33, 150, 243, 0.3)",
                    fill: true,
                    tension: 0.2,
                    pointRadius: 4
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: { display: true, text: "Monthly Games Played" }
                },
                scales: {
                    x: { title: { display: true, text: "Month" } },
                    y: { title: { display: true, text: "Games" }, beginAtZero: true }
                }
            }
        });
    </script>

    <p style="text-align:center;"><a href="{{ url_for('index') }}">Back to Home</a></p>
</body>
</html>

